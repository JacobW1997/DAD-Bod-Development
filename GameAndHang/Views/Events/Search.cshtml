@*@model GameAndHang.Models.Event*@
@model IEnumerable<GameAndHang.Models.Event>


@{
    ViewBag.Title = "Search";
}

@*<h2>Search for an event by game title</h2>
    <div class="container">
        @Html.TextBox("Search") <input type="submit" id="button" value="Search" />
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Event Name</th>
                    <th>Event Date</th>
                    <th>Game</th>
                </tr>
            </thead>
            <tbody id="data">
                @foreach(var item in Model)
                {
                    <tr>
                        <td>@item.EventName</td>
                        <td>@item.Date</td>
                        <td>@item.UnsupGames</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <script src="~/Scripts/jquery-3.4.1.min.js"></script>

    <script>
        $(document).ready(function () {
            $("#button").click(function () {
                var search = $("#Search").val();
                var data = $("#data");
                data.html("")
                $.ajax({
                    type: "post",
                    url: "/Events/GetData?data=" + search,
                    contentType: "html",
                    success: function (result) {
                        if (result.length == 0) {
                            data.append('<tr style="color:red"><td colspan="3">No Match</td></tr>')
                        }
                        else {
                            $.each(result, function (Index, value) {
                                var returnData = "<tr>" +
                                    "<td>" + value.EventName + "</td>" +
                                    "<td>" + value.UnsupGames + "</td>" +
                                    "<td> <a href='/Events/Details/'" + value. + ">Details</a> </td>" +
                                    "</tr>";
                                data.append(returnData);
                            })
                        }
                    }
                });
            });
        });
    </script>*@

<body onload="getUserLoc(), initMap()">
    <br />

    @*<div class="jumbotron">*@
    <h3 style="text-align:center">
        Search for an Event!
    </h3>
    @*</div>*@

    <div class="row">
        <div class="col-md-auto">
            <div>
                Search by Event Name
            </div>
            @using (Html.BeginForm("Search", "Events", FormMethod.Get))
            {
                @Html.TextBox("search")
                @*@Html.Hidden("UserLat", "", new { @id = "userlat" })
                @Html.Hidden("UserLong", "", new { @id = "userlong" })*@
                <input hidden name="UserLat" id="userlat" type="text" />
                <input hidden name="UserLong" id="userlong" type="text" />
                <input id="userlochere" type="submit" value="Search" />
            }
        </div>
        <div class="col-md-auto">
            <div>
                Search by Game
            </div>
            @using (Html.BeginForm("SearchBox", "Events", FormMethod.Get))
            {
                @Html.DropDownList("Games", null, htmlAttributes: new { @class = "form-control" })
                <input type="submit" value="Search" />
            }
        </div>
    </div>

    @if (Model.Count() > 0)
    {
        <div class="col-auto">
            <br />
            <h6> The following events within 30 miles matched your search criteria: </h6>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Event Name</th>
                        <th>Event Date</th>
                        <th>Games</th>
                        <th>Details</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model) {
                        <tr>
                            <td class="name">@item.EventName</td>
                            <td>@item.Date</td>
                            <td>@item.UnsupGames</td>
                            <td>@Html.ActionLink("Details", "Details", new { id = item.ID })</td>
                            <td hidden class="lat">@item.EventLat</td>
                            <td hidden class="long">@item.EventLong</td>
                        </tr>
                    }

                </tbody>
            </table>
        </div>
        <div class="col-auto">
            <div id="map" style="width: 520px; height: 480px; padding: 10px; color: black;"></div>
        </div>
    }
</body>


<script src="~/Scripts/API Scripts/SearchMapEtc.js"></script>

<script async defer
        src=@ViewBag.ApiUrl>
</script>